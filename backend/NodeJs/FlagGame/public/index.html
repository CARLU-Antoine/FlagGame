<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contrôle des Drapeaux Communicants</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .drapeau {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 5px;
        }
        .etat {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            background-color: #ccc;
        }
        .etat.rouge { background-color: red; }
        .etat.bleu { background-color: blue; }
        .etat.inactif { background-color: #ccc; }
        .controles {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }
        button {
            padding: 8px 16px;
            cursor: pointer;
        }
        .historique {
            margin-top: 20px;
            border: 1px solid #ddd;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
        }
        .log-entry {
            margin-bottom: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>Contrôle des Drapeaux Communicants</h1>
    
    <div class="container">
        <div class="drapeau" id="drapeau1">
            <h2>Drapeau 1</h2>
            <p>
                État actuel: 
                <span class="etat" id="etat-drapeau1"></span>
                <span id="texte-etat-drapeau1">Inactif</span>
            </p>
            <div class="controles">
                <button onclick="envoyerCommande('rouge')">Rouge</button>
                <button onclick="envoyerCommande('bleu')">Bleu</button>
                <button onclick="envoyerCommande('inactif')">Désactiver</button>
            </div>
        </div>
        
        <div class="historique">
            <h3>Historique des événements</h3>
            <div id="log"></div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // Connexion à Socket.IO
        const socket = io();
        
        // Fonction pour mettre à jour l'affichage de l'état d'un drapeau
        function mettreAJourEtat(id, etat) {
            const etatElement = document.getElementById(`etat-${id}`);
            const texteEtatElement = document.getElementById(`texte-etat-${id}`);
            
            // Supprimer toutes les classes d'état
            etatElement.classList.remove('rouge', 'bleu', 'inactif');
            
            // Ajouter la classe appropriée
            etatElement.classList.add(etat);
            
            // Mettre à jour le texte
            texteEtatElement.textContent = etat.charAt(0).toUpperCase() + etat.slice(1);
            
            // Ajouter un message dans l'historique
            ajouterLog(`Drapeau ${id} est maintenant ${etat}`);
        }
        
        // Fonction pour envoyer une commande
        function envoyerCommande(commande) {
            socket.emit('commande-drapeau', { commande: commande });
            ajouterLog(`Commande envoyée: ${commande}`);
        }
        
        // Fonction pour ajouter un message à l'historique
        function ajouterLog(message) {
            const log = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            
            log.prepend(entry);
        }
        
        // Écouter les mises à jour d'état
        socket.on('etat-drapeau', (data) => {
            mettreAJourEtat(data.id, data.etat);
        });
        
        // Écouter les états initiaux
        socket.on('etats-drapeaux', (etats) => {
            for (const [id, etat] of Object.entries(etats)) {
                mettreAJourEtat(id, etat);
            }
        });
        
        // Se connecter au serveur
        socket.on('connect', () => {
            ajouterLog('Connecté au serveur');
        });
        
        // Déconnexion
        socket.on('disconnect', () => {
            ajouterLog('Déconnecté du serveur');
        });
    </script>
</body>
</html>